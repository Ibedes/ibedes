---
interface Tool {
  id: string;
  name: string;
  shortDescription: string;
  description: string;
  category: string;
  tags: string[];
  url: string;
  github?: string | null;
  stars?: number | null;
  license: string;
  featured: boolean;
  addedDate: string;
  review: {
    rating: number;
    kuratorNotes: string;
    pros: string[];
    cons: string[];
    useCases: string[];
    difficulty: string;
    timeToLearn: string;
  };
  popularity: {
    views: number;
    clicks: number;
    trendScore: number;
  };
}

interface Props {
  tool: Tool;
  featured?: boolean;
  layout?: 'card' | 'compact' | 'featured';
}

const { tool, featured = false, layout = 'card' } = Astro.props;

// Format stars count
const formatStars = (stars: number | null) => {
  if (!stars) return null;
  if (stars >= 1000) {
    return `${(stars / 1000).toFixed(1)}k`;
  }
  return stars.toString();
};

// Get category color
const getCategoryColor = (category: string) => {
  const colors: { [key: string]: string } = {
    "Design": "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",
    "Development": "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300", 
    "Productivity": "bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",
    "Default": "bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"
  };
  return colors[category] || colors["Default"];
};

// Get license color
const getLicenseColor = (license: string) => {
  const colors: { [key: string]: string } = {
    "MIT": "bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400",
    "Apache 2.0": "bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",
    "GPL v2": "bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400",
    "Freemium": "bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400",
    "Proprietary": "bg-gray-50 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400",
    "MPL 2.0": "bg-purple-50 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400",
    "Default": "bg-gray-50 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"
  };
  return colors[license] || colors["Default"];
};

// Get category icon
const getCategoryIcon = (category: string) => {
  const icons: { [key: string]: string } = {
    "Design": "fa-palette",
    "Development": "fa-code",
    "Productivity": "fa-rocket",
    "Other": "fa-cog"
  };
  return icons[category] || icons["Other"];
};

// Get difficulty badge color
const getDifficultyColor = (difficulty: string) => {
  const colors: { [key: string]: string } = {
    "Beginner": "bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400",
    "Intermediate": "bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400",
    "Advanced": "bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400"
  };
  return colors[difficulty] || colors["Beginner"];
};
---

<a 
  href={`/tools/${tool.id}`}
  class={`tool-card group relative block bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border border-gray-200/50 dark:border-gray-700/50 rounded-3xl p-8 hover:shadow-2xl hover:-translate-y-3 transition-all duration-500 overflow-hidden ${
    featured ? 'ring-2 ring-blue-500/30 shadow-2xl bg-gradient-to-br from-blue-50/50 to-indigo-50/30 dark:from-blue-950/30 dark:to-indigo-950/20' : 'hover:border-blue-300/50 dark:hover:border-blue-600/50'
  }`}
  data-tool
  data-category={tool.category.toLowerCase()}
  data-name={tool.name}
  data-short-description={tool.shortDescription}
  data-description={tool.description}
  data-tags={tool.tags.join(' ').toLowerCase()}
  data-rating={tool.review.rating}
  data-trend-score={tool.popularity.trendScore}
  data-clicks={tool.popularity.clicks}
  data-added-date={tool.addedDate}
>
  <!-- Dynamic Background Gradient -->
  <div class="absolute inset-0 bg-gradient-to-br from-blue-50/0 via-indigo-50/0 to-purple-50/0 dark:from-blue-950/0 dark:via-indigo-950/0 dark:to-purple-950/0 group-hover:from-blue-50/30 group-hover:via-indigo-50/20 group-hover:to-purple-50/30 dark:group-hover:from-blue-950/20 dark:group-hover:via-indigo-950/10 dark:group-hover:to-purple-950/20 transition-all duration-700"></div>
  
  <!-- Content -->
  <div class="relative z-10 space-y-6">
    <!-- Header Section -->
    <div class="flex items-start justify-between">
      <div class="flex-1">
        <!-- Tool Name & Featured Badge -->
        <div class="flex items-start gap-3 mb-4">
          <div class="flex-1">
            <h3 class="text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent group-hover:from-blue-600 group-hover:to-indigo-600 dark:group-hover:from-blue-400 dark:group-hover:to-indigo-400 transition-all duration-300 leading-tight">
              {tool.name}
            </h3>
          </div>
          {featured && (
            <span class="px-3 py-1 text-xs font-bold bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-full shadow-lg animate-pulse flex items-center gap-1">
              <i class="fa-solid fa-sparkles text-xs"></i>
              Featured
            </span>
          )}
        </div>

        <!-- Category & License Tags -->
        <div class="flex flex-wrap gap-2 mb-4">
          <span class={`inline-flex items-center gap-2 px-3 py-2 text-xs font-semibold rounded-full border ${getCategoryColor(tool.category)} border-current/20 shadow-sm`}>
            <i class={`fa-solid ${getCategoryIcon(tool.category)} text-xs`}></i>
            {tool.category}
          </span>
          <span class={`inline-flex items-center gap-1 px-3 py-2 text-xs font-semibold rounded-full border ${getLicenseColor(tool.license)} border-current/20 shadow-sm`}>
            <i class="fa-solid fa-shield-halved text-xs"></i>
            {tool.license}
          </span>
        </div>

        <!-- Rating & Difficulty -->
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <div class="flex text-amber-400">
              {'★'.repeat(tool.review.rating)}{'☆'.repeat(5 - tool.review.rating)}
            </div>
            <span class="text-sm font-bold text-gray-700 dark:text-gray-300">{tool.review.rating}/5</span>
          </div>
          <span class={`px-2 py-1 text-xs font-semibold rounded-full border ${getDifficultyColor(tool.review.difficulty)} border-current/20`}>
            {tool.review.difficulty}
          </span>
        </div>
      </div>
    </div>

    <!-- Description -->
    <p class="text-gray-600 dark:text-gray-400 leading-relaxed text-base">
      {tool.shortDescription}
    </p>

    <!-- Stats Row -->
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-6 text-sm">
        {tool.stars && (
          <div class="flex items-center gap-1 text-amber-500 hover:text-amber-600 transition-colors">
            <i class="fa-solid fa-star"></i>
            <span class="font-semibold">{formatStars(tool.stars)}</span>
          </div>
        )}
        <div class="flex items-center gap-1 text-orange-500 hover:text-orange-600 transition-colors">
          <i class="fa-solid fa-fire"></i>
          <span class="font-semibold">{tool.popularity.trendScore}</span>
        </div>
        <div class="flex items-center gap-1 text-blue-500 hover:text-blue-600 transition-colors">
          <i class="fa-solid fa-eye"></i>
          <span class="font-semibold">{tool.popularity.views}</span>
        </div>
      </div>
      
      <!-- Time to Learn Badge -->
      <span class="text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-full">
        {tool.review.timeToLearn}
      </span>
    </div>

    <!-- Tags -->
    <div class="flex flex-wrap gap-2">
      {tool.tags.slice(0, 4).map((tag) => (
        <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-full hover:bg-blue-100 hover:text-blue-700 dark:hover:bg-blue-900/30 dark:hover:text-blue-400 transition-all duration-300 cursor-default border border-gray-200/50 dark:border-gray-700/50">
          {tag}
        </span>
      ))}
      {tool.tags.length > 4 && (
        <span class="px-3 py-1 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 rounded-full border border-gray-200/50 dark:border-gray-700/50">
          +{tool.tags.length - 4} more
        </span>
      )}
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 pt-2">
      <div class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 rounded-2xl font-semibold text-sm text-center group-hover:shadow-xl group-hover:from-blue-500 group-hover:to-indigo-500 transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
        <i class="fa-solid fa-star"></i>
        Lihat Review
      </div>
      
      <a 
        href={tool.url}
        target="_blank"
        rel="noopener noreferrer"
        class="px-4 py-4 border-2 border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm rounded-2xl hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20 dark:hover:border-blue-600 transition-all duration-300 hover:scale-105 active:scale-95 flex items-center justify-center"
        title="Kunjungi Website"
        onclick="event.stopPropagation()"
      >
        <i class="fa-solid fa-external-link-alt text-gray-600 dark:text-gray-400"></i>
      </a>
      
      {tool.github && (
        <a 
          href={`https://github.com/${tool.github}`}
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-4 border-2 border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm rounded-2xl hover:bg-gray-50 hover:border-gray-300 dark:hover:bg-gray-800/50 dark:hover:border-gray-600 transition-all duration-300 hover:scale-105 active:scale-95 flex items-center justify-center"
          title="View on GitHub"
          onclick="event.stopPropagation()"
        >
          <i class="fa-brands fa-github text-gray-600 dark:text-gray-400"></i>
        </a>
      )}
    </div>
  </div>
</a>

<style>
  .tool-card {
    backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(229, 231, 235, 0.5);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dark .tool-card {
    background: rgba(17, 24, 39, 0.8);
    border-color: rgba(75, 85, 99, 0.5);
  }
  
  .tool-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 
      0 25px 50px -12px rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(59, 130, 246, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .dark .tool-card:hover {
    box-shadow: 
      0 25px 50px -12px rgba(0, 0, 0, 0.5),
      0 0 0 1px rgba(59, 130, 246, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  /* Enhanced animations */
  .tool-card {
    animation: slideUp 0.6s ease-out forwards;
    opacity: 0;
    transform: translateY(30px);
  }

  @keyframes slideUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Gradient text effect */
  .gradient-text {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Improved focus states */
  .tool-card:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }

  /* Loading state */
  .tool-card.loading {
    opacity: 0.6;
    pointer-events: none;
  }

  /* Card entrance animations */
  .tool-card:nth-child(1) { animation-delay: 0.1s; }
  .tool-card:nth-child(2) { animation-delay: 0.2s; }
  .tool-card:nth-child(3) { animation-delay: 0.3s; }
  .tool-card:nth-child(4) { animation-delay: 0.4s; }
  .tool-card:nth-child(5) { animation-delay: 0.5s; }
  .tool-card:nth-child(6) { animation-delay: 0.6s; }

  /* Hover effects for interactive elements */
  .tool-card .action-button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .tool-card .action-button:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  /* Badge animations */
  .tool-card .badge {
    transition: all 0.3s ease;
  }

  .tool-card .badge:hover {
    transform: scale(1.05);
  }

  /* Text selection */
  .tool-card::selection {
    background: rgba(59, 130, 246, 0.2);
  }
</style>