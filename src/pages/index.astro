---
import { GLOBAL } from "../lib/variables";
import { articles } from "../lib/list";
import Layout from "../layouts/Layout.astro";
import Hero from "../components/home/Hero.astro";
import Section from "../components/common/Section.astro";
import FeaturedArticles from "../components/home/FeaturedArticles.astro";
import SubscribeCard from "../components/SubscribeCard.astro";
import AffiliateProducts from "../components/AffiliateProducts.astro";
import { loadAffiliateProductsRanked } from "../lib/affiliates";

// Run this page on the server so affiliate data stays fresh
export const prerender = false;

// Kombinasi klik + recency + verified untuk urutan yang paling relevan
const rankedAffiliateProducts = await loadAffiliateProductsRanked({
  days: 30,
  limit: 12,
});

const homepageAffiliateProducts = rankedAffiliateProducts.slice(0, 6);
const homepageArticles = articles.slice(0, 5);
---

<Layout
  title={`${GLOBAL.username} â€¢ ${GLOBAL.shortDescription}`}
  description={GLOBAL.longDescription}
  image={`${GLOBAL.rootUrl}/zaggonaut.png`}
>
  <Hero />

  <Section>
    <FeaturedArticles featuredArticles={homepageArticles} />
    <div class="mt-12"></div>
  </Section>
  <Section>
    <AffiliateProducts
      products={homepageAffiliateProducts}
      title="Rekomendasi Produk Affiliate"
      context="Pilihan produk terkurasi yang sering kupakai. Klik untuk dukung konten lewat tautan resmi."
    />
    <SubscribeCard />
  </Section>
</Layout>
